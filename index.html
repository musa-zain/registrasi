<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pendaftaran Sholat Idul Fitri - Okayama Central Mosque</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:#f1f5f9;
  color:#1e293b;
}
main{padding:40px 16px}
.container{max-width:480px;margin:auto}

.header{text-align:center;margin-bottom:28px}
.header h1{margin:0;font-size:24px;color:#064e3b;font-weight:700}
.header div{font-size:13px;color:#64748b;margin-top:4px}

.card{
  background:#fff;
  padding:28px;
  border-radius:22px;
  border:1px solid #e2e8f0;
}

.field{margin-bottom:22px}
label{
  display:block;
  margin-bottom:6px;
  font-weight:600;
  font-size:12px;
  color:#475569;
  letter-spacing:.04em;
}

.input-wrapper{position:relative}
.input-wrapper i{
  position:absolute;
  left:16px;
  top:50%;
  transform:translateY(-50%);
  color:#94a3b8;
}

input,select{
  width:100%;
  padding:12px 14px 12px 44px;
  border-radius:14px;
  border:1.5px solid #e2e8f0;
  font-size:14px;
  background:#f8fafc;
}

input:focus,select:focus{
  outline:none;
  border-color:#10b981;
  background:#fff;
}

/* Perbaikan tampilan select di iPad */
select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  line-height: 1.4;
  padding-right: 40px;
}

/* Khusus tablet (iPad) */
@media (min-width: 768px) and (max-width: 1024px) {
  select {
    height: 48px;
    font-size: 14px;
  }
}

/* Gender Button Layout */
.gender-group{
  display:flex;
  gap:12px;
}

.gender-group input{
  display:none;
}

.gender-group label{
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:12px 14px 12px 44px; /* SAMA dengan input */
  border-radius:14px;
  border:1.5px solid #e2e8f0;
  background:#f8fafc;
  font-size:14px;
  font-weight:500;
  line-height:1;               /* ðŸ”¥ KUNCI PRESISI */
  cursor:pointer;
  transition:.2s ease;
  color:#475569;
}

.gender-group label i{
  font-size:16px;
}

.gender-group input:checked + label{
  background:#ecfdf5;
  border-color:#10b981;
  color:#064e3b;
}

/* iPad / Tablet optimization */
@media (min-width:768px) {
  .gender-group label{
    padding:16px;
    font-size:15px;
  }
}

/* Style OTP Layout */
.otp-container { display: flex; gap: 8px; }
.btn-otp {
  width: auto;
  white-space: nowrap;
  padding: 0 16px;
  font-size: 12px;
  border-radius: 12px;
  background: #064e3b;
  color: #fff;
  border: none;
  cursor: pointer;
}
.btn-otp:disabled { background: #cbd5e1; cursor: not-allowed; }

input[name="domisili"]{
  padding:12px 14px 12px 44px; /* sama dengan input lain */
  font-size:14px;
}

.hint{
  font-size:12px;
  color:#94a3b8;
  margin-top:6px;
}

.row{display:flex;gap:14px}
.row .field{flex:1}

button{
  width:100%;
  padding:16px;
  background:#059669;
  color:#fff;
  border:none;
  border-radius:16px;
  font-weight:600;
  font-size:15px;
  cursor:pointer;
}
button:disabled{background:#cbd5e1;cursor:not-allowed}

.consent{
  display:flex;
  gap:12px;
  padding:14px;
  background:#f0fdf4;
  border:1px solid #dcfce7;
  border-radius:14px;
  font-size:13px;
}
.consent input{
  width:20px;
  height:20px;
  accent-color:#10b981;
}

.alert{
  display:none;
  background:#fff1f2;
  color:#be123c;
  padding:12px;
  border-radius:12px;
  margin-bottom:18px;
  text-align:center;
  font-size:13px;
}

footer{text-align:center;font-size:12px;color:#94a3b8;padding:28px}

@media(max-width:480px){
  .row{flex-direction:column}
}
</style>
</head>

<body>

<main>
<div class="container">

<div class="alert" id="duplicateAlert"
 data-id="Data ini sudah terdaftar"
 data-en="This data is already registered"
 data-ja="ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™"></div>

<div class="header">
  <h1 data-id="Pendaftaran Sholat Idul Fitri"
      data-en="Eid Prayer Registration"
      data-ja="å‚åŠ ç™»éŒ²"></h1>
  <div>Okayama Central Mosque</div>
</div>

<div class="card">
<form id="registrationForm">

<div class="field">
<label data-id="Nama Lengkap" data-en="Full Name" data-ja="æ°å"></label>
<div class="input-wrapper">
<i class="fas fa-user"></i>
<input name="nama_lengkap" id="nama_lengkap" required
 data-id-ph="Nama sesuai identitas"
 data-en-ph="Name as shown on ID"
 data-ja-ph="èº«åˆ†è¨¼é€šã‚Šã®æ°å">
</div>
</div>

<div class="field">
<label>Email</label>
<div class="otp-container">
  <div class="input-wrapper" style="flex:1">
    <i class="fas fa-envelope"></i>
    <input type="email" name="email" id="email" required placeholder="contoh@email.com">
  </div>
  <button type="button" class="btn-otp" id="sendOtpBtn" onclick="sendOTP()">
    <span data-id="Kirim Kode" data-en="Send Code" data-ja="ã‚³ãƒ¼ãƒ‰é€ä¿¡"></span>
  </button>
</div>
<div class="hint"
 data-id="Email ini digunakan untuk konfirmasi pendaftaran"
 data-en="This email will be used for registration confirmation"
 data-ja="ç¢ºèªã®ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™"></div>
</div>

<div class="field" id="otpField" style="display:none; background:#f0fdf4; padding:15px; border-radius:14px; border:1px dashed #10b981">
<label data-id="Masukkan Kode OTP" data-en="Enter OTP Code" data-ja="OTPã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›"></label>
<div class="input-wrapper">
<i class="fas fa-key"></i>
<input type="text" id="otp_input" maxlength="4" placeholder="1234">
</div>
</div>

<div class="field">
<label data-id="Nomor HP" data-en="Phone Number" data-ja="é›»è©±ç•ªå·"></label>
<div class="input-wrapper">
<i class="fas fa-phone"></i>
<input type="tel" name="no_hp" id="no_hp" required placeholder="08012345678">
</div>
<div class="hint"
 data-id="Gunakan nomor yang bisa dihubungi"
 data-en="Use an active phone number"
 data-ja="é€£çµ¡å¯èƒ½ãªç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></div>
</div>

<div class="field">
<label data-id="Domisili" data-en="City / Residence" data-ja="å±…ä½åœ°"></label>
<div class="input-wrapper">
<i class="fas fa-map-marker-alt"></i>
<input name="domisili" list="neighborhoods" required
 data-id-ph="Cari kelurahan (Contoh: Kaminakano)"
 data-en-ph="Search neighborhood (Ex: Kaminakano)"
 data-ja-ph="ç”ºåã‚’æ¤œç´¢ (ä¾‹ï¼šä¸Šä¸­é‡Ž)">
<datalist id="neighborhoods">
  <option value="Okayama-shi, Kita-ku, Kaminakano">
  <option value="Okayama-shi, Kita-ku, Ima">
  <option value="Okayama-shi, Kita-ku, Omoto">
  <option value="Okayama-shi, Kita-ku, Tsushima">
  <option value="Okayama-shi, Kita-ku, Hokan-cho">
  <option value="Okayama-shi, Naka-ku, Nishigawara">
  <option value="Okayama-shi, Minami-ku, Toyonari">
  
  <option value="Kurashiki-shi, Achi">
  <option value="Kurashiki-shi, Nakasho">
  <option value="Kurashiki-shi, Chaya-machi">
  <option value="Kurashiki-shi, Mizushima">
  <option value="Kurashiki-shi, Kojima">
  <option value="Kurashiki-shi, Tamashima">

  <option value="Tamano-shi, Chikko">
  <option value="Tamano-shi, Uno">
  <option value="Tamano-shi, Hibibi">
  <option value="Tamano-shi, Shibukawa">

  <option value="Soja-shi, Chuo">
  <option value="Soja-shi, Kiyone">
  <option value="Soja-shi, Yamate">

  <option value="Akaiwa-shi, Sanyo">
  <option value="Setouchi-shi, Oku-cho">
</datalist>
</div>
</div>

<div class="row">
<div class="field">
<label data-id="Usia" data-en="Age" data-ja="å¹´é½¢"></label>
<div class="input-wrapper">
<i class="fas fa-id-card"></i>
<input type="number" name="usia" required>
</div>
</div>

<div class="field">
<label data-id="Jumlah Orang" data-en="Number of People" data-ja="äººæ•°"></label>
<div class="input-wrapper">
<i class="fas fa-users"></i>
<input type="number" name="jumlah_orang" min="1" value="1" required>
</div>
<div class="hint"
 data-id="Jumlah orang yang hadir, termasuk Anda"
 data-en="Total number of attendees, including you"
 data-ja="ã”æœ¬äººã‚’å«ã‚€äººæ•°"></div>
</div>
</div>

<div class="field">
<label data-id="Jenis Kelamin" data-en="Gender" data-ja="æ€§åˆ¥"></label>

<div class="gender-group">
  <input type="radio" id="jk_l" name="jk" value="Laki-laki" required>
  <label for="jk_l">
    <i class="fas fa-mars"></i>
    <span data-id="Laki-laki" data-en="Male" data-ja="ç”·æ€§"></span>
  </label>

  <input type="radio" id="jk_p" name="jk" value="Perempuan">
  <label for="jk_p">
    <i class="fas fa-venus"></i>
    <span data-id="Perempuan" data-en="Female" data-ja="å¥³æ€§"></span>
  </label>
</div>
</div>

<div class="field">
<label class="consent">
<input type="checkbox" required>
<span data-id="Saya menyetujui data digunakan untuk keperluan acara ini"
      data-en="I agree that my data will be used for this event"
      data-ja="æœ¬ã‚¤ãƒ™ãƒ³ãƒˆã®ãŸã‚ã«å€‹äººæƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«åŒæ„ã—ã¾ã™"></span>
</label>
</div>

<button id="submitBtn"
 data-id="Daftar"
 data-en="Register"
 data-ja="ç™»éŒ²"></button>

</form>
</div>
</div>
</main>

<footer>Â© 2026 â€” Masjid Central Okayama</footer>

<script>
// 1. PASTIKAN URL SAMA DENGAN SISTEM ADMIN
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyJpXnfNup1G_LfUFQn9wfnKckDhBoehVvFy4N_9aoy3gOHGViS4UVTmbuQ-CHVGuIp/exec"; 

const lang = navigator.language.startsWith("ja") ? "ja" :
             navigator.language.startsWith("en") ? "en" : "id";

document.querySelectorAll("[data-id]").forEach(el => {
  el.textContent = el.dataset[lang] || el.dataset.id;
});
document.querySelectorAll("[data-id-ph]").forEach(el => {
  el.placeholder = el.dataset[`${lang}Ph`] || el.dataset.idPh;
});

let serverOTP = "";
let isVerified = false;

// Fungsi Kirim OTP
async function sendOTP() {
  const emailVal = document.getElementById("email").value;
  const namaVal = document.getElementById("nama_lengkap").value;
  
  if(!emailVal || !namaVal) {
    alert(lang === "id" ? "Isi Nama dan Email" : "Fill Name and Email");
    return;
  }

  const btn = document.getElementById("sendOtpBtn");
  btn.disabled = true;
  btn.textContent = "...";

  try {
    const r = await fetch(`${SCRIPT_URL}?action=send_otp&email=${encodeURIComponent(emailVal)}&nama=${encodeURIComponent(namaVal)}`);
    const j = await r.json();
    if(j.status === "success") {
      serverOTP = j.otp;
      document.getElementById("otpField").style.display = "block";
      alert(lang === "id" ? "OTP Terkirim!" : "OTP Sent!");
      
      document.getElementById("otp_input").oninput = function() {
        if(this.value === serverOTP) {
          isVerified = true;
          this.disabled = true;
          document.getElementById("otpField").style.background = "#dcfce7";
          document.getElementById("otpField").style.borderColor = "#10b981";
        }
      };
    }
  } catch(e) {
    alert("Error sending OTP");
    btn.disabled = false;
  }
}

// Cek Duplikat
let t;
document.getElementById("email").oninput = document.getElementById("no_hp").oninput = () => {
  clearTimeout(t);
  t = setTimeout(async () => {
    const email = document.getElementById("email").value;
    const no_hp = document.getElementById("no_hp").value;
    if(email && no_hp) {
      const r = await fetch(`${SCRIPT_URL}?action=check_duplicate&email=${email}&no_hp=${no_hp}`);
      const j = await r.json();
      document.getElementById("duplicateAlert").style.display = j.isDuplicate ? "block" : "none";
      document.getElementById("submitBtn").disabled = j.isDuplicate;
    }
  }, 800);
};

// SUBMIT FORM KE SISTEM BARU
document.getElementById("registrationForm").onsubmit = async e => {
  e.preventDefault();
  
  if(!isVerified) {
    alert(lang === "id" ? "Verifikasi OTP dulu" : "Verify OTP first");
    return;
  }

  const btn = document.getElementById("submitBtn");
  btn.disabled = true;
  const originalText = btn.textContent;
  btn.textContent = "...";

  // Ambil data form
  const form = document.getElementById("registrationForm");
  const formData = new FormData(form);
  
  // Konversi FormData ke Objek biasa agar mudah dibaca GAS
  const data = {};
  formData.forEach((value, key) => { data[key] = value; });

  // Tambahkan info tambahan sesuai kebutuhan GAS
  data.action = "register";
  data.lang = lang;

  try {
    // Kirim menggunakan metode POST sesuai fungsi doPost(e) di GAS
    const response = await fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
    
    const result = await response.json();
    
    if(result.status === "success") {
      // Redirect ke halaman sukses (bawa ID untuk ditampilkan di QR)
      window.location.href = `success.html?id=${result.id}&nama=${encodeURIComponent(data.nama_lengkap)}`;
    } else {
      alert("Error: " + result.message);
      btn.disabled = false;
      btn.textContent = originalText;
    }
  } catch(e) {
    alert("Terjadi kesalahan koneksi");
    btn.disabled = false;
    btn.textContent = originalText;
  }
};
</script>

</body>
</html>
