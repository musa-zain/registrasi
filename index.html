<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pendaftaran Sholat Idul Fitri</title>
    <style>
        * { box-sizing: border-box; }
        body { min-height: 100vh; margin: 0; display: flex; flex-direction: column; font-family: system-ui, -apple-system, sans-serif; font-size: 15px; line-height: 1.6; color: #1f2937; background-color: #f8fafc; }
        main { flex: 1; padding: 32px 16px; }
        .container { max-width: 460px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 18px; padding-top: 12px; }
        .header h1 { font-size: 22px; margin: 0; color: #065f46; font-weight: 700; }
        .masjid-name { font-size: 17px; font-weight: 600; color: #065f46; margin-top: 2px; }
        .card { background: #fff; border-radius: 16px; padding: 26px 22px; border: 1px solid #e5e7eb; }
        .field { margin-bottom: 20px; }
        label { display: block; font-weight: 500; margin-bottom: 6px; color: #374151; }
        input, textarea { width: 100%; padding: 11px 12px; font-size: 15px; border: 1px solid #d1d5db; border-radius: 8px; }
        input:focus { outline: none; border-color: #047857; box-shadow: 0 0 0 3px #d1fae5; }
        button { width: 100%; padding: 13px; font-size: 15px; font-weight: 600; background-color: #047857; color: #fff; border: none; border-radius: 10px; cursor: pointer; transition: all .2s; }
        button:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .alert { padding: 12px 16px; border-radius: 10px; margin-bottom: 20px; font-size: 14px; display: none; background-color: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        footer { text-align: center; padding: 18px; font-size: 12px; color: #6b7280; }
    </style>
</head>
<body>

<main>
    <div class="container">
        <div class="alert" id="duplicateAlert">⚠️ Data (Email/HP) sudah terdaftar sebelumnya!</div>
        
        <div class="header">
            <h1 data-id="Form Pendaftaran Sholat Idul Fitri" data-ja="参加登録フォーム" data-en="Registration Form"></h1>
            <div class="masjid-name">Okayama Central Mosque</div>
        </div>

        <div class="card">
            <form id="registrationForm">
                <div class="field">
                    <label data-id="Nama Lengkap" data-ja="氏名" data-en="Full Name"></label>
                    <input type="text" name="nama_lengkap" required>
                </div>
                <div class="field">
                    <label>Email</label>
                    <input type="email" name="email" id="email" required>
                </div>
                <div class="field">
                    <label data-id="Nomor HP / WhatsApp" data-ja="電話番号" data-en="Phone"></label>
                    <input type="tel" name="no_hp" id="no_hp" inputmode="numeric" pattern="[0-9]{9,15}" required>
                </div>
                <div class="field">
                    <label data-id="Domisili" data-ja="居住地" data-en="City"></label>
                    <input type="text" name="domisili" required>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div class="field" style="flex: 1;">
                        <label data-id="Usia" data-ja="年齢" data-en="Age"></label>
                        <input type="number" name="usia" required>
                    </div>
                    <div class="field" style="flex: 1;">
                        <label data-id="Jumlah Orang" data-ja="人数" data-en="People"></label>
                        <input type="number" name="jumlah_orang" min="1" value="1" required>
                    </div>
                </div>
                <div class="field">
                    <label data-id="Jenis Kelamin" data-ja="性別" data-en="Gender"></label>
                    <select name="jk" style="width: 100%; padding: 11px; border-radius: 8px; border: 1px solid #d1d5db;">
                        <option value="Laki-laki">Laki-laki / Male</option>
                        <option value="Perempuan">Perempuan / Female</option>
                    </select>
                </div>
                <button type="submit" id="submitBtn" data-id="Daftar" data-ja="登録" data-en="Register"></button>
            </form>
        </div>
    </div>
</main>

<footer>© 2026 — Yayasan Ibadurrahman Islamic Center</footer>

<script>
const SCRIPT_URL = "URL_GOOGLE_APPS_SCRIPT_ANDA"; // GANTI DENGAN URL ASLI ANDA

// Multi-language Logic
const lang = navigator.language.startsWith("ja") ? "ja" : navigator.language.startsWith("en") ? "en" : "id";
document.querySelectorAll("[data-id]").forEach(el => { el.textContent = el.dataset[lang] || el.dataset.id; });

// Duplicate Check Logic (mencegah pendaftaran berulang)
let timer;
const checkDuplicate = () => {
    clearTimeout(timer);
    timer = setTimeout(async () => {
        const email = document.getElementById('email').value;
        const no_hp = document.getElementById('no_hp').value;
        if (email.includes('@') && no_hp.length > 8) {
            try {
                const res = await fetch(`${SCRIPT_URL}?action=check_duplicate&email=${encodeURIComponent(email)}&no_hp=${encodeURIComponent(no_hp)}`);
                const data = await res.json();
                document.getElementById('duplicateAlert').style.display = data.isDuplicate ? 'block' : 'none';
                document.getElementById('submitBtn').disabled = data.isDuplicate;
            } catch (e) { console.error("Check failed", e); }
        }
    }, 1000);
};

document.getElementById('email').addEventListener('input', checkDuplicate);
document.getElementById('no_hp').addEventListener('input', checkDuplicate);

// Submit Logic
document.getElementById('registrationForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const btn = document.getElementById('submitBtn');
    const originalText = btn.innerText;
    btn.disabled = true;
    btn.innerText = "...";

    const formData = new FormData(this);
    const uniqueId = "EID-" + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substr(2, 3).toUpperCase();
    formData.append("action", "register");
    formData.append("id", uniqueId);

    try {
        const response = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        const result = await response.json();
        
        if (result.status === 'success') {
            const params = new URLSearchParams(formData);
            window.location.href = `success.html?${params.toString()}`;
        } else {
            alert(result.message || "Pendaftaran gagal.");
            btn.disabled = false;
            btn.innerText = originalText;
        }
    } catch (e) {
        alert("Terjadi kesalahan koneksi.");
        btn.disabled = false;
        btn.innerText = originalText;
    }
});
</script>
</body>
</html>
