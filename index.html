<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pendaftaran Sholat Idul Fitri</title>

    <style>
        * { box-sizing: border-box; }

        body {
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            font-family:
                -apple-system,
                BlinkMacSystemFont,
                "Segoe UI",
                Roboto,
                Helvetica,
                Arial,
                sans-serif;
            font-size: 15px;
            line-height: 1.6;
            color: #1f2937;
            background-color: #f8fafc;
        }

        main {
            flex: 1;
            padding: 32px 16px;
        }

        .container {
            max-width: 460px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 18px;
            position: relative;
            padding-top: 12px;
        }

        .header::after {
            content: "";
            display: block;
            width: 80px;
            height: 2px;
            margin: 10px auto 0;
            background: linear-gradient(to right, transparent, #047857, transparent);
            opacity: 0.35;
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 2px;
            color: #065f46;
            font-weight: 700;
        }

        .masjid-name {
            font-size: 17px;
            font-weight: 600;
            color: #065f46;
            margin-top: 2px;
            letter-spacing: 0.6px;
        }

        .card {
            background-color: #ffffff;
            border-radius: 14px;
            padding: 24px 20px;
            border: 1px solid #e5e7eb;
            position: relative;
        }

        .card::before {
            content: "";
            position: absolute;
            inset: 0;
            background-image:
                radial-gradient(circle at 1px 1px, #047857 1px, transparent 1px);
            background-size: 18px 18px;
            opacity: 0.03;
            pointer-events: none;
            border-radius: 14px;
        }

        .field { margin-bottom: 18px; }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 6px;
            color: #374151;
        }

        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="tel"],
        textarea {
            width: 100%;
            padding: 11px 12px;
            height: 44px;
            font-size: 15px;
            font-family: inherit;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            transition: border-color 0.15s, box-shadow 0.15s;
            background-color: #ffffff;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            height: auto;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #047857;
            box-shadow: 0 0 0 3px #d1fae5;
        }

        .radio-group label,
        .checkbox label {
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        input[type="radio"],
        input[type="checkbox"] {
            transform: scale(1.1);
            accent-color: #047857;
        }

        button {
            width: 100%;
            padding: 13px;
            font-size: 15px;
            font-weight: 500;
            background-color: #047857;
            color: #ffffff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:disabled {
            background-color: #9ca3af;
            cursor: not-allowed;
        }

        footer {
            text-align: center;
            padding: 18px 10px;
            font-size: 12px;
            color: #6b7280;
            background-color: #ecfdf5;
        }

        @media (min-width: 768px) {
            .header h1 { font-size: 24px; }
            .masjid-name { font-size: 19px; }
        }
    </style>
</head>

<body>

<main>
<div class="container">

<div class="header">
    <h1 data-id="Form Pendaftaran Sholat Idul Fitri"
        data-ja="ã‚¤ãƒ‰ã‚¥ãƒ«ãƒ»ãƒ•ã‚£ãƒˆãƒªç¤¼æ‹ å‚åŠ ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ "
        data-en="Eid al-Fitr Prayer Registration Form"></h1>

    <div class="masjid-name"
         data-id="Masjid Central Okayama"
         data-ja="å²¡å±±ã‚»ãƒ³ãƒˆãƒ©ãƒ«ãƒ¢ã‚¹ã‚¯"
         data-en="Okayama Central Mosque"></div>
</div>

<div class="card">
<form method="POST">

<div class="field">
<label data-id="Nama Lengkap" data-ja="æ°å" data-en="Full Name"></label>
<input type="text" name="nama_lengkap" required>
</div>

<div class="field">
<label data-id="Email" data-ja="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" data-en="Email"></label>
<input type="email" name="email" required>
</div>

<div class="field">
<label data-id="Domisili / Kota" data-ja="å±…ä½åœ°" data-en="City"></label>
<textarea name="domisili" required></textarea>
</div>

<div class="field">
<label data-id="Nomor HP / WhatsApp" data-ja="é›»è©±ç•ªå·" data-en="Phone Number"></label>
<input type="tel"
       name="no_hp"
       inputmode="numeric"
       pattern="[0-9]{10,13}"
       minlength="10"
       maxlength="13"
       oninput="this.value=this.value.replace(/[^0-9]/g,'')"
       required>
</div>

<div class="field">
<label data-id="Usia" data-ja="å¹´é½¢" data-en="Age"></label>
<input type="number" name="usia" required>
</div>

<div class="field radio-group">
<label data-id="Jenis Kelamin" data-ja="æ€§åˆ¥" data-en="Gender"></label>

<label>
<input type="radio" name="jk" value="Laki-laki" required>
<span data-id="Laki-laki" data-ja="ç”·æ€§" data-en="Male"></span>
</label>

<label>
<input type="radio" name="jk" value="Perempuan">
<span data-id="Perempuan" data-ja="å¥³æ€§" data-en="Female"></span>
</label>
</div>

<div class="field checkbox">
<label>
<input type="checkbox" name="setuju" required>
<span data-id="Saya menyetujui data digunakan untuk keperluan acara ini"
      data-ja="æœ¬ã‚¤ãƒ™ãƒ³ãƒˆã®ç›®çš„ã§å€‹äººæƒ…å ±ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«åŒæ„ã—ã¾ã™"
      data-en="I agree that my data may be used for this event"></span>
</label>
</div>

<button type="submit"
        data-id="Daftar"
        data-ja="ç™»éŒ²"
        data-en="Register"></button>

</form>

<script>
// ==================== KONFIGURASI ====================
const CONFIG = {
    // ðŸ”´ GANTI DENGAN URL GOOGLE APPS SCRIPT ANDA
    // Contoh: "https://script.google.com/macros/s/.../exec"
    GOOGLE_SCRIPT_URL: "https://script.google.com/macros/s/AKfycbw5PaHfUA6KDv7dDhVhWlfv5CakUK_-06_iYLP5LXHeqZhNVDgBYqFqJi-cR1EwMJXtvQ/exec",
    
    // â±ï¸ Waktu tunggu sebelum redirect (milidetik)
    REDIRECT_DELAY: 1500
};

// ==================== HANDLE FORM SUBMIT ====================
document.querySelector('form').addEventListener('submit', async function(e) {
    e.preventDefault(); // Mencegah reload halaman
    
    const form = this;
    const submitButton = form.querySelector('button[type="submit"]');
    const originalText = submitButton.innerHTML;
    
    try {
        // Tampilkan loading
        submitButton.disabled = true;
        submitButton.textContent = getLoadingText();
        
        // Buat FormData dari form
        const formData = new FormData(form);
        
        // Tambahkan timestamp dan referer
        formData.append('timestamp', new Date().toISOString());
        formData.append('source', 'website_form');
        
        // Kirim ke Google Apps Script
        const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // Penting untuk Google Apps Script
            body: formData
        });
        
        // Berhasil: Tampilkan pesan sukses
        submitButton.textContent = getSuccessText();
        submitButton.style.backgroundColor = '#10b981';
        
        // Tunggu sebentar, lalu redirect ke success.html
        setTimeout(() => {
            window.location.href = "success.html";
        }, CONFIG.REDIRECT_DELAY);
        
    } catch (error) {
        console.error('Error:', error);
        
        // Reset button ke kondisi awal
        submitButton.disabled = false;
        submitButton.innerHTML = originalText;
        submitButton.style.backgroundColor = '';
        
        // Tampilkan alert error sesuai bahasa
        alert(getErrorMessage());
    }
});

// ==================== HELPER FUNCTIONS ====================
function getCurrentLanguage() {
    const lang = (navigator.languages && navigator.languages[0]) || navigator.language || "id";
    if (lang.startsWith("ja")) return "ja";
    if (lang.startsWith("en")) return "en";
    return "id";
}

function getLoadingText() {
    const lang = getCurrentLanguage();
    const texts = {
        id: "Mengirim...",
        ja: "é€ä¿¡ä¸­...",
        en: "Sending..."
    };
    return texts[lang];
}

function getSuccessText() {
    const lang = getCurrentLanguage();
    const texts = {
        id: "âœ“ Berhasil!",
        ja: "âœ“ æˆåŠŸã—ã¾ã—ãŸï¼",
        en: "âœ“ Success!"
    };
    return texts[lang];
}

function getErrorMessage() {
    const lang = getCurrentLanguage();
    const texts = {
        id: "Gagal mengirim data. Coba lagi.",
        ja: "ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚",
        en: "Failed to send data. Please try again."
    };
    return texts[lang];
}

// ==================== VALIDASI REAL-TIME NOMOR HP ====================
const phoneInput = document.querySelector('input[name="no_hp"]');
if (phoneInput) {
    phoneInput.addEventListener('input', function(e) {
        // Hanya izinkan angka
        this.value = this.value.replace(/[^0-9]/g, '');
        
        // Validasi panjang (opsional styling)
        if (this.value.length > 0 && this.value.length < 10) {
            this.style.borderColor = '#f87171';
        } else {
            this.style.borderColor = '';
        }
    });
}

// ==================== DETEKSI OFFLINE ====================
window.addEventListener('offline', function() {
    const messages = {
        id: "âš ï¸ Anda sedang offline. Periksa koneksi internet.",
        ja: "âš ï¸ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæŽ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
        en: "âš ï¸ You are offline. Please check your internet connection."
    };
    
    alert(messages[getCurrentLanguage()]);
});
</script>

</div>

</div>
</main>

<footer>
Â© 2025 â€” Yayasan Ibadurrahman Islamic Center
</footer>

<script>
// ==================== MULTI LANGUAGE ====================
(function () {
  const lang = (navigator.languages && navigator.languages[0]) || navigator.language || "id";
  let current = "id";
  if (lang.startsWith("ja")) current = "ja";
  else if (lang.startsWith("en")) current = "en";

  document.querySelectorAll("[data-id]").forEach(el => {
    el.textContent = el.dataset[current] || el.dataset.id;
  });
})();
</script>

</body>
</html>
