<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pendaftaran Sholat Idul Fitri</title>

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f8fafc;
  color: #1f2937;
}
main { padding: 32px 16px; }
.container { max-width: 460px; margin: auto; }
.header { text-align: center; margin-bottom: 16px; }
.header h1 { margin: 0; font-size: 22px; color: #065f46; }
.card {
  background: #fff;
  padding: 24px;
  border-radius: 16px;
  border: 1px solid #e5e7eb;
}
.field { margin-bottom: 18px; }
label { display: block; margin-bottom: 6px; font-weight: 500; }
input, select {
  width: 100%;
  padding: 11px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
}
button {
  width: 100%;
  padding: 13px;
  background: #047857;
  color: #fff;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
}
button:disabled { background: #9ca3af; }
.alert {
  display: none;
  background: #fee2e2;
  color: #991b1b;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 15px;
}
footer { text-align: center; font-size: 12px; color: #6b7280; padding: 18px; }
</style>
</head>

<body>

<main>
<div class="container">
  <div class="alert" id="duplicateAlert">⚠️ Data sudah terdaftar</div>

  <div class="header">
    <h1 data-id="Form Pendaftaran Sholat Idul Fitri"
        data-en="Registration Form"
        data-ja="参加登録フォーム"></h1>
    <div>Okayama Central Mosque</div>
  </div>

  <div class="card">
    <form id="registrationForm">
      <div class="field">
        <label data-id="Nama Lengkap" data-en="Full Name" data-ja="氏名"></label>
        <input name="nama_lengkap" required>
      </div>

      <div class="field">
        <label>Email</label>
        <input type="email" name="email" id="email" required>
      </div>

      <div class="field">
        <label data-id="Nomor HP" data-en="Phone" data-ja="電話番号"></label>
        <input type="tel" name="no_hp" id="no_hp" required>
      </div>

      <div class="field">
        <label data-id="Domisili" data-en="City" data-ja="居住地"></label>
        <input name="domisili" required>
      </div>

      <div style="display:flex;gap:10px;">
        <div class="field" style="flex:1;">
          <label data-id="Usia" data-en="Age" data-ja="年齢"></label>
          <input type="number" name="usia" required>
        </div>
        <div class="field" style="flex:1;">
          <label data-id="Jumlah Orang" data-en="People" data-ja="人数"></label>
          <input type="number" name="jumlah_orang" min="1" value="1" required>
        </div>
      </div>

      <div class="field">
        <label data-id="Jenis Kelamin" data-en="Gender" data-ja="性別"></label>
        <select name="jk" required>
          <option value="" disabled selected>--</option>
          <option value="Laki-laki" data-id="Laki-laki" data-en="Male" data-ja="男性"></option>
          <option value="Perempuan" data-id="Perempuan" data-en="Female" data-ja="女性"></option>
        </select>
      </div>

      <!-- PERSETUJUAN DATA -->
      <div class="field">
        <label style="display:flex;gap:8px;font-size:13px;">
          <input type="checkbox" required>
          <span data-id="Saya menyetujui data digunakan untuk keperluan acara"
                data-en="I agree my data will be used for this event"
                data-ja="本イベントのために個人情報を使用することに同意します"></span>
        </label>
      </div>

      <button id="submitBtn" data-id="Daftar" data-en="Register" data-ja="登録"></button>
    </form>
  </div>
</div>
</main>

<footer>© 2026 — Masjid Central Okayama</footer>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwkmGaHISHLF4yWm2jKM_PjVp5ocCyjXReDNS1a1DV-ipj6wDBbz6FnM5bJT0T1NB2dzQ/exec";

// Language
const lang = navigator.language.startsWith("ja") ? "ja"
           : navigator.language.startsWith("en") ? "en" : "id";
document.querySelectorAll("[data-id]").forEach(el=>{
  el.textContent = el.dataset[lang] || el.dataset.id;
});

// Translate option
document.querySelectorAll("option[data-id]").forEach(o=>{
  o.textContent = o.dataset[lang] || o.dataset.id;
});

// Duplicate check
let t;
email.oninput = no_hp.oninput = ()=>{
  clearTimeout(t);
  t=setTimeout(async()=>{
    if(email.value && no_hp.value){
      const r = await fetch(`${SCRIPT_URL}?action=check_duplicate&email=${email.value}&no_hp=${no_hp.value}`);
      const j = await r.json();
      duplicateAlert.style.display = j.isDuplicate ? "block":"none";
      submitBtn.disabled = j.isDuplicate;
    }
  },800);
};

// Submit
registrationForm.onsubmit = async e=>{
  e.preventDefault();
  submitBtn.disabled = true;

  const fd = new FormData(registrationForm);
  fd.append("action","register");
  fd.append("id","EID-"+Date.now().toString(36).toUpperCase());

  const r = await fetch(SCRIPT_URL,{method:"POST",body:fd});
  const j = await r.json();

  if(j.status==="success"){
    window.location.href = "success.html?"+new URLSearchParams(fd).toString();
  }else{
    alert(j.message||"Gagal");
    submitBtn.disabled=false;
  }
};
</script>

</body>
</html>
