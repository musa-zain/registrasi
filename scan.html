<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner Panitia - OCM</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; margin: 0; text-align: center; background: #111; color: white; min-height: 100vh; }
        #reader { width: 100%; max-width: 500px; margin: auto; background: #000; border-radius: 0 0 20px 20px; overflow: hidden; }
        .result-box { padding: 25px; margin: 20px; border-radius: 16px; display: none; animation: slideUp 0.3s ease; }
        
        /* Status Colors */
        .success { background: #059669; color: white; border: 2px solid #10b981; }
        .warning { background: #d97706; color: white; border: 2px solid #fbbf24; }
        .error { background: #dc2626; color: white; border: 2px solid #f87171; }
        
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .btn-scan { background: #3b82f6; color: white; padding: 15px 30px; border: none; border-radius: 12px; font-weight: bold; margin-top: 20px; cursor: pointer; font-size: 16px; }
        #status-text { margin: 15px 0; font-size: 14px; color: #94a3b8; }

        /* Login Overlay */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-card { background: #1e293b; padding: 40px 30px; border-radius: 24px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5); width: 85%; max-width: 350px; }
        .login-card input { width: 100%; padding: 15px; margin-top: 20px; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; text-align: center; font-size: 18px; box-sizing: border-box; }
        .login-card button { width: 100%; margin-top: 20px; padding: 15px; border-radius: 12px; border: none; background: #059669; color: white; font-weight: 800; cursor: pointer; font-size: 16px; }
        #login-err { color: #f87171; font-size: 13px; margin-top: 15px; display: none; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <div style="font-size: 50px; margin-bottom: 10px;">üïå</div>
            <h2 style="margin: 0; color: #f8fafc;">Panitia Bukber 2026</h2>
            <p style="color: #94a3b8; font-size: 14px;">Masukkan password scanner</p>
            <input type="password" id="pass-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button onclick="checkLogin()">MASUK SYSTEM</button>
            <p id="login-err">‚ö†Ô∏è Password Salah!</p>
        </div>
    </div>

    <div id="main-content">
        <div id="reader"></div>
        <div id="status-text">Menunggu Login...</div>

        <div id="result" class="result-box">
            <h2 id="res-title" style="margin: 0 0 10px 0;"></h2>
            <p id="res-msg" style="margin: 0; font-size: 18px; font-weight: bold;"></p>
            <p id="res-pax" style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.9;"></p>
        </div>

        <button class="btn-scan" onclick="restartScanner()">Mulai Scan Lagi</button>
    </div>

    <audio id="snd-success" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
    <audio id="snd-warning" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
    <audio id="snd-error" src="https://assets.mixkit.co/active_storage/sfx/2012/2012-preview.mp3"></audio>

    <script>
        // ==========================================
        // KONFIGURASI PANITIA
        // ==========================================
        const ADMIN_PASSWORD = "mco2026"; // Ganti password di sini
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwvLVMIbhBThHJ8l3d4Rppo1GvDbgeVjELq8_zOtzD7WHaWIaEHhVqHqyVJpgiaiDzp/exec"; // Ganti dengan URL Google Script Anda
        
        const html5QrCode = new Html5Qrcode("reader");
        const resultDiv = document.getElementById("result");
        const statusText = document.getElementById("status-text");

        // FUNGSI LOGIN
        function checkLogin() {
            const input = document.getElementById("pass-input").value;
            const err = document.getElementById("login-err");
            
            if (input === ADMIN_PASSWORD) {
                document.getElementById("login-overlay").style.display = "none";
                startScanner();
            } else {
                err.style.display = "block";
                playSound("error");
            }
        }

        // FUNGSI SUARA
        function playSound(type) {
            const snd = document.getElementById("snd-" + type);
            snd.currentTime = 0;
            snd.play();
        }

        // FUNGSI SCAN BERHASIL
        const onScanSuccess = (decodedText) => {
            html5QrCode.pause(true);
            statusText.innerText = "üîç Mengecek database: " + decodedText;
            
            fetch(`${SCRIPT_URL}?action=verifyQR&qrData=${encodeURIComponent(decodedText)}`)
            .then(res => res.json())
            .then(data => {
                resultDiv.style.display = "block";
                
                if(data.status === "success") {
                    playSound("success");
                    resultDiv.className = "result-box success";
                    document.getElementById("res-title").innerText = "‚úÖ BERHASIL";
                    document.getElementById("res-msg").innerText = data.nama;
                    document.getElementById("res-pax").innerText = "Total Jemaah: " + data.pax + " Orang";
                } 
                else if(data.status === "duplicate") {
                    playSound("warning");
                    resultDiv.className = "result-box warning";
                    document.getElementById("res-title").innerText = "‚ö†Ô∏è SUDAH HADIR";
                    document.getElementById("res-msg").innerText = data.data.nama;
                    document.getElementById("res-pax").innerText = "ID ini sudah masuk sebelumnya.";
                } 
                else {
                    playSound("error");
                    resultDiv.className = "result-box error";
                    document.getElementById("res-title").innerText = "‚ùå TIDAK ADA";
                    document.getElementById("res-msg").innerText = "ID Tidak Terdaftar";
                    document.getElementById("res-pax").innerText = "QR Code Random atau Salah.";
                }

                // Otomatis scan lagi setelah 4 detik
                setTimeout(() => {
                    restartScanner();
                }, 4000);
            })
            .catch(err => {
                alert("Kesalahan Koneksi Internet!");
                restartScanner();
            });
        };

        function startScanner() {
            statusText.innerText = "Kamera Aktif. Siap Scan...";
            html5QrCode.start(
                { facingMode: "environment" }, 
                { fps: 10, qrbox: { width: 250, height: 250 } },
                onScanSuccess
            ).catch(err => {
                statusText.innerText = "Gagal akses kamera. Pastikan izin diberikan.";
            });
        }

        function restartScanner() {
            resultDiv.style.display = "none";
            html5QrCode.resume();
            statusText.innerText = "Siap scan jemaah berikutnya...";
        }
    </script>
</body>
</html>
