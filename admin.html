<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard Panitia - Idul Fitri</title>

<style>
:root{
  --green:#047857;
  --green-soft:#d1fae5;
  --red:#991b1b;
  --red-soft:#fee2e2;
  --gray:#6b7280;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,sans-serif;
  background:#f8fafc;
  color:#1f2937;
  padding:24px;
}
.container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:24px;
  border-radius:18px;
  border:1px solid #e5e7eb;
  box-shadow:0 10px 20px rgba(0,0,0,.05);
}

h1{
  margin:0 0 20px;
  color:var(--green);
  display:flex;
  align-items:center;
  gap:10px;
}

/* ===== STATS ===== */
.stats{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:16px;
  margin-bottom:25px;
}
.stat{
  background:#f9fafb;
  padding:18px;
  border-radius:14px;
  border:1px solid #e5e7eb;
  text-align:center;
}
.stat span{
  font-size:32px;
  font-weight:800;
  color:var(--green);
}
.stat label{
  display:block;
  margin-top:4px;
  font-size:12px;
  color:var(--gray);
  letter-spacing:.5px;
  text-transform:uppercase;
}

/* ===== BUTTON ===== */
.actions{
  display:flex;
  gap:10px;
  margin-bottom:15px;
}
button{
  padding:10px 16px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:600;
}
.btn-refresh{background:var(--green);color:#fff}
.btn-export{background:#111827;color:#fff}

/* ===== TABLE ===== */
.table-wrap{
  overflow:auto;
  border-radius:14px;
  border:1px solid #e5e7eb;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  padding:12px;
  border-bottom:1px solid #f3f4f6;
  white-space:nowrap;
}
th{
  background:#f9fafb;
  text-transform:uppercase;
  font-size:11px;
  letter-spacing:.5px;
}
tr:hover{background:#f8fafc}

/* ===== BADGE ===== */
.badge{
  padding:6px 12px;
  border-radius:20px;
  font-size:11px;
  font-weight:700;
}
.hadir{background:var(--green-soft);color:var(--green)}
.belum{background:var(--red-soft);color:var(--red)}

.loading{
  padding:40px;
  text-align:center;
  color:var(--gray);
}
</style>
</head>

<body>

<div class="container">
  <h1>üìä Dashboard Panitia</h1>

  <!-- STATS -->
  <div class="stats">
    <div class="stat"><span id="totalReg">0</span><label>Total Registrasi</label></div>
    <div class="stat"><span id="totalPax">0</span><label>Total Jamaah</label></div>
    <div class="stat"><span id="totalHadir">0</span><label>Sudah Check-in</label></div>
    <div class="stat"><span id="totalBelum">0</span><label>Belum Check-in</label></div>
  </div>

  <!-- ACTION -->
  <div class="actions">
    <button class="btn-refresh" onclick="loadData()">üîÑ Refresh</button>
    <button class="btn-export" onclick="exportCSV()">‚¨áÔ∏è Export CSV</button>
  </div>

  <div id="loading" class="loading">Memuat data peserta‚Ä¶</div>

  <!-- TABLE -->
  <div class="table-wrap">
    <table id="table" style="display:none">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nama</th>
          <th>Email</th>
          <th>No HP</th>
          <th>Domisili</th>
          <th>JK</th>
          <th>Pax</th>
          <th>Status</th>
          <th>Waktu</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwkmGaHISHLF4yWm2jKM_PjVp5ocCyjXReDNS1a1DV-ipj6wDBbz6FnM5bJT0T1NB2dzQ/exec";
let allData=[];

async function loadData(){
  loading.style.display="block";
  table.style.display="none";

  const r=await fetch(`${SCRIPT_URL}?action=getList`);
  const j=await r.json();
  allData=j.data||[];
  render(allData);

  loading.style.display="none";
  table.style.display="table";
}

function render(data){
  tbody.innerHTML="";
  let pax=0, hadir=0;

  data.forEach(d=>{
    const isHadir=d[9]==="Sudah Hadir";
    if(isHadir) hadir++;
    pax+=Number(d[8]||1);

    tbody.innerHTML+=`
      <tr>
        <td><b>${d[0]}</b></td>
        <td>${d[2]}</td>
        <td>${d[3]}</td>
        <td>${d[5]}</td>
        <td>${d[4]}</td>
        <td>${d[7]}</td>
        <td>${d[8]}</td>
        <td><span class="badge ${isHadir?'hadir':'belum'}">${d[9]}</span></td>
        <td>${d[10]||'-'}</td>
      </tr>`;
  });

  totalReg.textContent=data.length;
  totalPax.textContent=pax;
  totalHadir.textContent=hadir;
  totalBelum.textContent=data.length-hadir;
}

function exportCSV(){
  if(!allData.length) return alert("Data kosong");

  let csv="ID,Nama,Email,HP,Domisili,JK,Pax,Status,Waktu\n";
  allData.forEach(d=>{
    csv+=`"${d[0]}","${d[2]}","${d[3]}","${d[5]}","${d[4]}","${d[7]}","${d[8]}","${d[9]}","${d[10]}"\n`;
  });

  const b=new Blob([csv],{type:"text/csv"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download=`Dashboard_IdulFitri_${Date.now()}.csv`;
  a.click();
}

loadData();
</script>

</body>
</html>
